<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Carousel Downloader | InstaSaver</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root { --insta-grad: linear-gradient(45deg, #833AB4, #FD1D1D, #FCAF45); }
  body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; margin:0; text-align:center; }
  body.light-mode { background:#f5f5f7; color:#000; }
  
  /* Shared Nav Styles from index.html would go here usually */
  .fcc-nav { background:#0a0a23; height:50px; display:flex; align-items:center; justify-content:space-between; padding:0 20px; }
  .fcc-logo { background: var(--insta-grad); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; font-weight:bold; font-size:20px; text-decoration:none; }

  /* Gallery */
  #gallery { display:flex; gap:20px; overflow-x:auto; padding: 20px; scroll-snap-type:x mandatory; }
  .card { 
      min-width: 300px; max-width:300px; background: #111; padding: 15px; border-radius: 16px; 
      border: 1px solid #333; scroll-snap-align: center; display:flex; flex-direction:column;
  }
  .thumb-container { width: 100%; height: 300px; border-radius: 10px; overflow: hidden; margin-bottom:10px; background:#222;}
  .thumb-container img { width:100%; height:100%; object-fit:cover; }
  
  .btn { background: var(--insta-grad); color: white; border: none; padding: 10px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: auto;}
  
  /* Loader */
  .loader { border: 4px solid #333; border-top: 4px solid #FD1D1D; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 50px auto; }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  
  body.light-mode .card { background: #fff; border-color: #ddd; }
</style>
</head>
<body>

<nav class="fcc-nav">
  <a href="index.html" class="fcc-logo">InstaSaver</a>
  <button onclick="location.href='index.html'" style="background:none; border:1px solid #fff; color:#fff; padding:5px 10px; border-radius:4px; cursor:pointer;">Back</button>
</nav>

<div id="loader" class="loader"></div>
<div id="gallery" style="display:none;"></div>
<button id="dl-all" style="display:none; margin: 20px auto; padding: 15px 30px; background: #fff; color: #000; border: none; border-radius: 30px; font-weight: bold; cursor: pointer;">Download All Images</button>

<script>
async function load() {
  const links = new URLSearchParams(location.search).get("links");
  const res = await fetch(`/api?url=${encodeURIComponent(links)}`);
  const json = await res.json();
  const data = json.data;

  const gallery = document.getElementById("gallery");
  const loader = document.getElementById("loader");
  
  if(data && data.images) {
    loader.style.display = "none";
    gallery.style.display = "flex";
    document.getElementById("dl-all").style.display = "block";

    data.images.forEach((img, idx) => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
            <div class="thumb-container"><img src="${img}"></div>
            <div style="font-size:12px; color:#888; margin-bottom:10px;">${idx + 1} / ${data.images.length}</div>
            <button class="btn" onclick="dl('${img}', '${data.id}', ${idx})">Download Image</button>
        `;
        gallery.appendChild(div);
    });

    document.getElementById("dl-all").onclick = async () => {
        for(let i=0; i<data.images.length; i++) {
            dl(data.images[i], data.id, i);
            await new Promise(r => setTimeout(r, 1500));
        }
    }
  }
}

function dl(url, id, idx) {
    window.location.href = `/image?url=${encodeURIComponent(url)}&id=${id}&index=${idx+1}`;
}

load();
</script>
</body>
</html>
